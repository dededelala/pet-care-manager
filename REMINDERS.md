# 邮件提醒系统使用指南

## 🎯 功能概述

为宠物健康管理系统添加了邮件提醒功能，用户可以为每只宠物设置个性化的健康护理提醒，通过邮件及时获得通知。

## ✨ 功能特性

- ✅ **4种提醒类型**：外驱、内驱、疫苗、洗澡
- ✅ **自定义周期**：用户可设置提醒间隔（1-365天）
- ✅ **邮件通知**：美观的HTML邮件模板
- ✅ **智能提醒**：到期前3天和到期当天发送
- ✅ **灵活管理**：随时启用/禁用/编辑提醒
- ✅ **自动运行**：Vercel Cron Jobs 每日自动检查

## 📋 使用步骤

### 1. 配置邮件服务（可选）

如果不配置邮件服务，提醒会记录到控制台而不会实际发送。

**方式 A: 使用 Resend（推荐）**

1. 访问 [resend.com](https://resend.com) 注册账户
2. 创建 API Key
3. 在 Vercel Dashboard → Settings → Environment Variables 添加：
   ```
   RESEND_API_KEY=your_api_key_here
   ```

**方式 B: 使用 SMTP**

在 Vercel 环境变量中添加：
```
SMTP_HOST=smtp.your-provider.com
SMTP_PORT=587
SMTP_USER=your@email.com
SMTP_PASSWORD=your_password
```

### 2. 为宠物设置提醒

1. 访问宠物详情页面
2. 点击"🔔 设置提醒"按钮
3. 选择提醒类型（外驱/内驱/疫苗/洗澡）
4. 输入邮箱地址
5. 设置提醒周期（多少天一次）
6. 点击"添加"

### 3. 管理提醒

在提醒设置页面可以：
- ✅ 启用/禁用提醒
- ✏️ 编辑提醒设置
- 🗑️ 删除提醒

## ⏰ 自动提醒规则

系统会在以下情况发送邮件提醒：

1. **到期前3天** - 提前提醒
2. **到期当天** - 正式提醒
3. **逾期后** - 如果错过，系统会持续提醒

提醒邮件包含：
- 宠物名字
- 提醒类型
- 到期日期
- 查看详情的链接

## 🔧 技术实现

### 数据库

新增 `ReminderSettings` 表：
- `petId` - 关联的宠物
- `type` - 提醒类型
- `email` - 邮箱地址
- `intervalDays` - 提醒周期
- `isEnabled` - 是否启用
- `lastSent` - 上次发送时间
- `nextDueDate` - 下次到期日期

### API 端点

- `GET /api/reminders` - 获取提醒列表
- `POST /api/reminders` - 创建提醒
- `PUT /api/reminders/[id]` - 更新提醒
- `DELETE /api/reminders/[id]` - 删除提醒
- `GET /api/cron/send-reminders` - 定时任务（Vercel Cron 调用）

### 定时任务

在 `vercel.json` 中配置：
```json
{
  "crons": [
    {
      "path": "/api/cron/send-reminders",
      "schedule": "0 9 * * *"
    }
  ]
}
```

每天上午 9:00 自动检查并发送提醒邮件。

## 📧 邮件模板

邮件使用美观的 HTML 模板，包含：
- 宠物健康管理系统 Logo
- 提醒类型图标
- 宠物名字
- 到期日期
- 查看详情的按钮

## 🎨 界面预览

### 宠物详情页面
显示醒目的提醒设置入口，点击进入设置页面。

### 提醒设置页面
- 卡片式布局显示所有提醒
- 支持添加、编辑、删除、启用/禁用
- 清晰显示下次提醒时间

## 🔐 安全注意事项

1. **邮箱验证**：确保输入正确的邮箱地址
2. **隐私保护**：邮箱地址仅用于发送提醒
3. **频率控制**：避免设置过短的提醒周期（建议最少7天）

## 🚀 部署后操作

1. **推送代码到 GitHub**
2. **Vercel 自动部署**
3. **在 Vercel Dashboard 配置环境变量**（如果使用邮件服务）
4. **访问网站测试功能**

## 💡 使用建议

- **外驱**：建议每30天提醒一次
- **内驱**：建议每30天提醒一次
- **疫苗**：建议每365天提醒一次
- **洗澡**：建议每14天提醒一次

## 🐛 故障排除

**问题：没有收到邮件**
- 检查是否配置了邮件服务（RESEND_API_KEY 或 SMTP）
- 检查邮箱地址是否正确
- 查看垃圾邮件文件夹

**问题：提醒不发送**
- 确认提醒已启用
- 检查是否已到提醒时间
- 查看 Vercel Functions 日志

**问题：数据库表不存在**
- 运行 `npx prisma db push` 创建表
- 或访问 `/api/migrate` 端点

## 📞 支持

如有问题，请查看：
- Vercel Functions 日志
- 数据库中的提醒记录
- 邮件服务提供商的状态页面
